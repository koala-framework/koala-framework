var loaderUtils = require("loader-utils");

module.exports = function(source, map) {
    var query = loaderUtils.parseQuery(this.query);

    if (!query.cls) {
        this.emitError("Missing loader parameter cls");
        return;
    }

    this.cacheable();

    source = source.replace(/\.kwcClass/g, '.'+query.cls);
    if (query.ext === 'css' || query.ext === 'scss') {
        source = source.replace(/kwcBem/g, query.cls);
    } else {
        source = source.replace(/kwcBem__/g, query.cls+'__');
        source = source.replace(/kwcBem--/g, query.cls+'--');
    }

    return source;
};
