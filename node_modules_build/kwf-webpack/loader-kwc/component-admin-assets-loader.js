'use strict';
var path = require("path");
var loaderUtils = require("loader-utils");
var fs = require("fs");

module.exports = function(source, map) {

    this.cacheable();

    const componentAssets = JSON.parse(fs.readFileSync(process.cwd()+'/temp/component-assets-build/assets.json'));
    this.addDependency(process.cwd()+'/temp/component-assets-build/assets.json');

    let ret = '';
    for (let cmp in componentAssets) {
        let dep = componentAssets[cmp].assetsAdmin.dep;
        let files = componentAssets[cmp].assetsAdmin.files;
        dep.forEach(function(asset) {
            ret += "require('"+require.resolve('../loader/ini-loader')+"?dep="+asset+"!');\n";
        }, this);
        files.forEach(function(asset) {
            if (asset.match(/\.js$/)) {
                ret += "require('script-loader!" + asset + "');\n";
            } else {
                ret += "require('"+asset+"');\n";
            }
        }, this);
    }

    return ret;
};
